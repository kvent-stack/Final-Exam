---
title: "Analysis"
format:
  html:
    toc: true
    number-sections: true
execute:
  echo: true
  message: false
  warning: false
---

# Data Analysis

To understand how retail availability varies across the city, I first summarized the distribution of food retailers by community area.

```{r}
library(tidyverse)
library(sf)
library(tigris)
library(janitor)
library(arrow)
library(knitr)
library(scales)
library(ggplot2)
library(dplyr)
library(purrr)
library(tidyr)
library(leaflet)
library(tidycensus)

options(tigris_show_progress = FALSE)

chi_final = readRDS("data/chi_final.rds")

summary(chi_final$store_count)
```

[**Analytic Interpretation:**]{.underline} Store availability varies substantially across Chicago’s community areas, with half of neighborhoods having 89 or fewer food retailers and a small number of high-density commercial districts pulling the mean upward. The large gap between the median (89) and maximum (695) indicates a highly skewed distribution, suggesting concentrated retail clustering rather than even citywide access.


Because raw store counts do not account for neighborhood population differences, I examined a standardized measure of access: the number of stores per 10,000 residents.

```{r}
summary(chi_final$stores_per_10k)
```

[**Analytic Interpretation:**]{.underline} Per-capita access to food retailers varies widely across Chicago, with half of communities having fewer than 10.9 stores per 10,000 residents and a long upper tail of neighborhoods with much higher access. The large spread between the median (10.85) and the maximum (54.69) underscores substantial inequality in retail availability when population is taken into account.


To identify neighborhoods with unusually high concentrations of food retailers, I listed the ten communities with the highest number of stores per 10,000 residents.

```{r}
chi_final %>%
  arrange(desc(stores_per_10k)) %>%
  select(community, store_count, total_population, stores_per_10k) %>%
  slice_head(n = 10)
```

[**Analytic Interpretation:**]{.underline} Chicago’s highest per-capita retail access is concentrated in and around the central city, with the Loop, Near North Side, and Near West Side far outpacing all other neighborhoods. These areas combine dense commercial corridors with relatively modest residential populations, producing extremely high ratios of stores per 10,000 residents compared to the rest of the city.


To identify neighborhoods that may be underserved, I listed the ten communities with the lowest number of stores per 10,000 residents.

```{r}
chi_final %>%
  arrange(stores_per_10k) %>%
  select(community, store_count, total_population, stores_per_10k) %>%
  slice_head(n = 10)
```

[**Analytic Interpretation:**]{.underline} The neighborhoods with the lowest per-capita retail access are primarily located on the South and far Northwest sides, with several areas-such as Oakland, Burnside, and Riverdale-showing extremely limited availability relative to their population size. These values, many under 7 stores per 10,000 residents, highlight substantial geographic inequities in Chicago’s retail landscape and point to potential gaps in neighborhood-serving commercial infrastructure.


To assess how unevenly food retail access is distributed across Chicago, I calculated simple dispersion measures (variance, standard deviation, and IQR) for stores per 10,000 residents.

```{r}
c(
  variance = var(chi_final$stores_per_10k, na.rm = TRUE),
  sd       = sd(chi_final$stores_per_10k, na.rm = TRUE),
  iqr      = IQR(chi_final$stores_per_10k, na.rm = TRUE)
)
```

[**Analytic Interpretation:**]{.underline} Retail access shows substantial dispersion across Chicago’s neighborhoods, with a standard deviation of roughly 10 stores per 10,000 residents-nearly as large as the median itself. The high variance and wide interquartile range (IQR ≈ 10.9) reinforce that retail access is unevenly distributed, with significant gaps between the least- and best-served communities.


To evaluate whether socioeconomic conditions help explain disparities in per-capita retail access, I incorporated median household income from the 2022 ACS, aggregated it to community areas, merged it into the analytical dataset, and estimated a linear regression predicting stores per 10,000 residents from income and population size.
```{r}
library(tigris)
options(tigris_use_cache = TRUE)

tracts_cc = tracts(state = "IL", county = "Cook", year = 2022, cb = TRUE) %>%
  st_as_sf() %>%
  clean_names()

acs_income = get_acs(
  geography = "tract",
  variables = "B19013_001",
  state = "IL",
  county = "Cook",
  year = 2022,
  geometry = FALSE
) %>%
  clean_names() %>%
  transmute(geoid, median_income = estimate)

tracts_income = tracts_cc %>%
  left_join(acs_income, by = "geoid")

community_geom = chi_final %>%
  select(community, geometry) %>%
  mutate(community = toupper(community))

tracts_income = st_transform(tracts_income, st_crs(community_geom))

tract_income_join = st_intersection(tracts_income, community_geom)

comm_income = tract_income_join %>%
  st_drop_geometry() %>%
  group_by(community) %>%
  summarise(median_income = mean(median_income, na.rm = TRUE))

chi_final = chi_final %>%
  mutate(community = toupper(community)) %>%
  left_join(comm_income, by = "community")

chi_final = chi_final %>%
  mutate(median_income = median_income) %>%
  select(-matches("median_income\\.x|median_income\\.y"))

model = lm(stores_per_10k ~ median_income + total_population, data = chi_final)
summary(model)
```
[**Analytic Interpretation:**]{.underline} The regression results indicate that both median household income and total population are significant predictors of per-capita retail access across Chicago’s community areas. Holding population constant, each additional $10,000 in median income is associated with roughly 1.36 additional stores per 10,000 residents, suggesting that commercial investment disproportionately gravitates toward wealthier neighborhoods. Total population also shows a positive relationship: larger communities tend to support slightly higher densities of food retailers even after the per-capita adjustment, likely reflecting the combined effects of foot traffic, customer base diversity, and business viability. The model explains about 33% of the variation in retail access (Adjusted R² = 0.315), indicating that socioeconomic conditions meaningfully-though not exclusively-structure the distribution of food retailers across the city. The sizable residual variance suggests that additional factors such as zoning, transit access, commercial corridors, or historical patterns of investment likely contribute to the remaining disparities.


To assess whether the linear model meets key assumptions, I generated standard diagnostic plots, including residuals vs. fitted values, a Q–Q plot, and leverage checks.
```{r}
par(mfrow = c(2,2))
plot(model)
par(mfrow = c(1,1))
```
[**Analytic Interpretation:**]{.underline} The diagnostic plots suggest that the linear model performs reasonably well but exhibits a few modest assumption violations. The residuals-vs-fitted and scale-location plots show mild curvature and some heteroskedasticity, indicating that the relationship between predictors and per-capita access may not be perfectly linear across the entire range of values. The Q–Q plot shows slight right-tail deviation, driven by a few high-access communities that behave as mild outliers. Finally, the leverage plot identifies a small number of influential observations, but none appear to exert disproportionate influence on the model’s coefficients. Overall, the model is sufficiently stable for exploratory analysis, though future refinements could incorporate nonlinear terms or robust estimation.

# Data Visualizations

This plot illustrates how food retailer counts vary across Chicago’s 77 community areas.
```{r}
ggplot(chi_final, aes(x = store_count)) +
  geom_histogram(bins = 30, fill = "#2C7FB8", color = "white") +
  theme_minimal() +
  labs(title="Distribution of Store Counts", x="Store Count", y="Communities")
```
[**Analytic Interpretation:**]{.underline} The distribution of store counts is heavily right-skewed, with most communities supporting between 40 and 150 food retailers while a handful of central neighborhoods contain several hundred. This pattern reflects Chicago’s commercial clustering, where downtown and adjacent areas absorb a disproportionate share of the city’s total retail activity.


This plot shows the distribution of stores per 10,000 residents, highlighting how standardized access differs across neighborhoods.
```{r}
ggplot(chi_final, aes(x = stores_per_10k)) +
  geom_histogram(bins = 30, fill = "#41B6C4", color="white") +
  theme_minimal() +
  labs(title="Distribution of Stores per 10k Residents",
       x="Stores per 10k", y="Communities")
```
[**Analytic Interpretation:**]{.underline} Standardizing by population reveals a similarly skewed pattern, with most communities falling between 8 and 20 stores per 10,000 residents and a small group far exceeding that range. The extended right tail highlights how a limited number of high-density, mixed-use neighborhoods drive much higher per-capita retail availability compared to the citywide norm.


This map displays the geographic distribution of total food retailer counts across Chicago.
```{r}
ggplot(chi_final) +
  geom_sf(aes(fill = store_count), color="white", size=0.2) +
  scale_fill_viridis_c() +
  theme_minimal()
```
[**Analytic Interpretation:**]{.underline} Total retailer counts are highest in the central city-particularly the Loop, Near North Side, Near West Side, and surrounding areas-where commercial density is strongest. Outlying neighborhoods show far lower store totals, underscoring an uneven distribution of commercial investment and business activity across Chicago.


This map highlights disparities in standardized retail access by showing stores per 10,000 residents.
```{r}
ggplot(chi_final) +
  geom_sf(aes(fill = stores_per_10k), color="white", size=0.2) +
  scale_fill_viridis_c(option="magma") +
  theme_minimal()
```
[**Analytic Interpretation:**]{.underline} When adjusted for population, per-capita access remains concentrated in the city’s core and along select North Side corridors, while large portions of the South and Southwest Sides exhibit noticeably lower access. This pattern suggests that both commercial density and residential composition jointly shape neighborhood-level availability of food retailers, amplifying geographic disparities in access.


To complement the static visualizations, I created an interactive map that allows users to explore individual retailer locations and their distribution across Chicago.
```{r}
grocery = st_read("https://data.cityofchicago.org/resource/xqx5-8hwx.geojson?$limit=50000")

grocery_map = grocery %>%
  st_transform(st_crs(chi_final)) %>%
  mutate(
    lon = st_coordinates(geometry)[,1],
    lat = st_coordinates(geometry)[,2]
  )

leaflet(grocery_map) %>%
  addTiles() %>%
  addCircleMarkers(
    lng = ~lon, lat = ~lat,
    radius = 2, stroke = FALSE, fillOpacity = 0.6
  )
```


K-means clustering is an unsupervised machine learning method that groups observations into distinct clusters based on their similarity. Here, I use it to identify whether Chicago’s community areas naturally sort into meaningful categories based on per-capita retail access and median household income, revealing whether structural patterns exist beyond simple linear relationships.
```{r}
cluster_data = chi_final %>%
  st_drop_geometry() %>%
  select(community, stores_per_10k, median_income) %>%
  drop_na()

cluster_scaled = cluster_data %>%
  select(stores_per_10k, median_income) %>%
  scale()

set.seed(123)
k3 = kmeans(cluster_scaled, centers = 3, nstart = 25)

cluster_data$cluster = factor(k3$cluster)

chi_final = chi_final %>%
  left_join(cluster_data %>% select(community, cluster), by = "community")

ggplot(chi_final) +
  geom_sf(aes(fill = cluster), color = "white", size = 0.2) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Clusters of Chicago Communities by Retail Access & Income",
    fill = "Cluster"
  ) +
  theme_minimal()

k3$centers
```
[**Analytic Interpretation:**]{.underline} The k-means clustering algorithm separates Chicago’s community areas into three clear groups based on retail access and neighborhood income. Cluster 1 (green) captures a small set of high-income, high-access neighborhoods concentrated downtown and on the North Side, where dense commercial corridors and strong consumer demand reinforce one another. Cluster 2 (orange) includes most South and Southwest Side communities and reflects the lowest retail access and lowest incomes, highlighting areas where structural disinvestment constrains residents’ options. Cluster 3 (blue) represents moderate-income, moderate-access neighborhoods that sit between these extremes and are largely distributed across the North and Northwest Sides. Together, the clusters show that retail access aligns closely with Chicago’s socioeconomic geography, revealing patterned inequities rather than random variation.