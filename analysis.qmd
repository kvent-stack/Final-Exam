---
title: "Analysis"
format:
  html:
    toc: true
    number-sections: true
execute:
  echo: true
  message: false
  warning: false
---

# Data Analysis

To understand how retail availability varies across the city, I first summarized the distribution of food retailers by community area. Raw store counts reveal how food retailers cluster spatially before accounting for population differences.

```{r}
library(tidyverse)
library(sf)
library(tigris)
library(janitor)
library(arrow)
library(knitr)
library(scales)
library(ggplot2)
library(dplyr)
library(purrr)
library(tidyr)
library(leaflet)
library(tidycensus)

options(tigris_show_progress = FALSE)

chi_final = readRDS("data/chi_final.rds")

summary(chi_final$store_count)
```

[**Analytic Interpretation:**]{.underline} Store availability varies substantially across Chicago’s community areas, with half of neighborhoods having 79 or fewer food retailers and a small number of high-density commercial districts pulling the average upward. The gap between the median (79) and the maximum (691) illustrates a heavily right-skewed distribution, indicating that retail activity is concentrated in a handful of commercial cores rather than evenly distributed across the city.

------------------------------------------------------------------------

Because raw store counts do not account for neighborhood population differences, I examined a standardized measure of access: the number of stores per 10,000 residents.

```{r}
summary(chi_final$stores_per_10k)
```

[**Analytic Interpretation:**]{.underline} Per-capita access to food retailers varies widely across Chicago, with half of communities having fewer than 10.7 stores per 10,000 residents and a long upper tail of neighborhoods with much higher access. The large spread between the median (10.74) and the maximum (54.77) underscores substantial inequality in retail availability when population is taken into account.

------------------------------------------------------------------------

To identify neighborhoods with unusually high concentrations of food retailers, I listed the ten communities with the highest number of stores per 10,000 residents.

```{r}
chi_final %>%
  st_drop_geometry() %>%
  arrange(desc(stores_per_10k)) %>%
  select(community, store_count, total_population, stores_per_10k) %>%
  slice_head(n = 10)
```

[**Analytic Interpretation:**]{.underline} Chicago’s highest per-capita retail access is concentrated in and around the central city, with the Loop, Near North Side, and Near West Side far outpacing all other neighborhoods. These areas combine dense commercial corridors with relatively low residential populations, producing extremely high ratios of stores per 10,000 residents compared to the rest of the city.

------------------------------------------------------------------------

To identify neighborhoods that may be underserved, I also listed the ten communities with the lowest number of stores per 10,000 residents.

```{r}
chi_final %>%
  st_drop_geometry() %>%
  arrange(stores_per_10k) %>%
  select(community, store_count, total_population, stores_per_10k) %>%
  slice_head(n = 10)
```

[**Analytic Interpretation:**]{.underline} The neighborhoods with the lowest per-capita retail access are primarily located on the South and far Northwest sides. Several areas - Oakland, Burnside, and Riverdale - showed extremely limited availability relative to their population size. These values (all under 8 stores per 10,000 residents) highlight substantial geographic inequities in Chicago’s retail landscape and point to potential gaps in neighborhood-serving commercial infrastructure.

------------------------------------------------------------------------

To assess how unevenly food retail access is distributed across Chicago, I calculated simple dispersion measures (variance, standard deviation, and IQR) for stores per 10,000 residents.

```{r}
c(
  variance = var(chi_final$stores_per_10k, na.rm = TRUE),
  sd       = sd(chi_final$stores_per_10k, na.rm = TRUE),
  iqr      = IQR(chi_final$stores_per_10k, na.rm = TRUE)
)
```

[**Analytic Interpretation:**]{.underline} Retail access shows substantial dispersion across Chicago’s neighborhoods, with a standard deviation of roughly 10 stores per 10,000 residents-nearly as large as the median itself. The high variance and wide interquartile range (IQR ≈ 10.9) reinforce that retail access is unevenly distributed, with significant gaps between the least- and best-served communities.

------------------------------------------------------------------------

To evaluate whether socioeconomic conditions help explain disparities in per-capita retail access, I incorporated median household income from the 2022 ACS. This data was aggregated to community areas and merged into the analytical dataset. I then estimated a linear regression predicting stores per 10,000 residents from income and population size.

```{r}
library(tigris)
options(tigris_use_cache = TRUE)

tracts_cc = tracts(state = "IL", county = "Cook", year = 2022, cb = TRUE) %>%
  st_as_sf() %>%
  clean_names()

acs_income = get_acs(
  geography = "tract",
  variables = "B19013_001",
  state = "IL",
  county = "Cook",
  year = 2022,
  geometry = FALSE
) %>%
  clean_names() %>%
  transmute(geoid, median_income = estimate)

tracts_income = tracts_cc %>%
  left_join(acs_income, by = "geoid")

community_geom = chi_final %>%
  select(community, geometry) %>%
  mutate(community = toupper(community))

tracts_income = st_transform(tracts_income, st_crs(community_geom))

tract_income_join = st_intersection(tracts_income, community_geom)

comm_income = tract_income_join %>%
  st_drop_geometry() %>%
  group_by(community) %>%
  summarise(median_income = mean(median_income, na.rm = TRUE))

chi_final = chi_final %>%
  mutate(community = toupper(community)) %>%
  left_join(comm_income, by = "community")

chi_final = chi_final %>%
  mutate(median_income = median_income) %>%
  select(-matches("median_income\\.x|median_income\\.y"))

model = lm(stores_per_10k ~ median_income + total_population, data = chi_final)
summary(model)
```

[**Analytic Interpretation:**]{.underline} The regression results indicate that both median household income and total population are significant predictors of per-capita retail access across Chicago’s community areas. The income coefficient suggests that for every \$10,000 increase in median household income, neighborhoods tend to have roughly 1.36 more stores per 10,000 residents (while holding population constant). This directly shows that commercial activity disproportionately concentrates in higher-income parts of the city. Total population also shows a positive association: larger communities support slightly higher densities of food retailers even after adjusting for population. Overall, the model explains about 33% of the variation in retail access (Adjusted R² = 0.315), meaning socioeconomic conditions play a meaningful but incomplete role in structuring Chicago’s retail landscape. The remaining unexplained variance points to additional drivers (zoning policies, transit access, historical investment pattern) that likely contribute to persistent geographic disparities.

# Data Visualizations

To assess whether the linear model meets key assumptions, I generated standard diagnostic plots, including residuals vs. fitted values, a Q–Q plot, and leverage checks.

```{r}
par(mfrow = c(2,2))
plot(model)
par(mfrow = c(1,1))
```

[**Analytic Interpretation:**]{.underline} The diagnostic plots indicate that the linear model fits reasonably well but shows a few mild assumption issues. The residuals-vs-fitted and scale-location plots show slight curvature and modest heteroskedasticity, suggesting that the relationship between income, population, and retail access is not perfectly linear across all neighborhoods. The Q–Q plot shows right-tail deviation, driven by a handful of communities with unusually high per-capita retail access. The residuals-vs-leverage plot identifies a few moderately influential areas, but none with leverage or Cook’s distance large enough to threaten model stability. Overall, the model is statistically sound for exploratory purposes.

------------------------------------------------------------------------

To visualize how food retailers are distributed across the city, I first examined the overall shape of the store-count distribution across Chicago’s 77 community areas.

```{r}
ggplot(chi_final, aes(x = store_count)) +
  geom_histogram(bins = 30, fill = "#2C7FB8", color = "white") +
  theme_minimal() +
  labs(title="Distribution of Store Counts", x="Store Count", y="Communities")
```

[**Analytic Interpretation:**]{.underline} The distribution of store counts is strongly right-skewed. Most Chicago communities fall in the 40–150 store range, while a small number of central, high-density commercial districts contain 200–700 stores, pulling the mean upward. The long right tail reflects Chicago’s spatially concentrated retail landscape: a handful of core neighborhoods absorb a disproportionate share of food retailers, while the majority of communities have far more modest commercial footprints.

------------------------------------------------------------------------

To assess how access shifts once neighborhood population is taken into account, I then plotted the distribution of per-capita retail availability across community areas.

```{r}
ggplot(chi_final, aes(x = stores_per_10k)) +
  geom_histogram(bins = 30, fill = "#41B6C4", color="white") +
  theme_minimal() +
  labs(title="Distribution of Stores per 10k Residents",
       x="Stores per 10k", y="Communities")
```

[**Analytic Interpretation:**]{.underline} Standardizing by population produces a distribution that remains strongly right-skewed. Most communities cluster between 8 and 20 stores per 10,000 residents, while a small number of outliers reach 30–55 stores per 10,000. These high-access neighborhoods stretch the right tail of the distribution. The pattern underscores how per-capita access is shaped not only by raw store counts but also by uneven population density, amplifying disparities between Chicago’s commercial core and its outlying communities.

------------------------------------------------------------------------

To understand how raw retail presence varies spatially, I mapped total store counts across Chicago’s community areas.

```{r}
ggplot(chi_final) +
  geom_sf(aes(fill = store_count), color="white", size=0.2) +
  scale_fill_viridis_c() +
  theme_minimal()
```

[**Analytic Interpretation:**]{.underline} Total retailer counts are overwhelmingly concentrated in Chicago’s central corridors - especially the Loop, Near North Side, and Near West Side - where dense commercial zoning and high foot traffic support several hundred stores per community. As the map moves outward, store counts drop sharply, with most outlying neighborhoods showing far lower totals. This stark spatial gradient highlights how Chicago’s retail landscape is structured around a small core of high-density commercial districts, leaving much of the city with comparatively limited brick-and-mortar food retail presence.

------------------------------------------------------------------------

Because raw counts can mask population differences, I mapped per-capita access to highlight neighborhoods where residents face particularly limited retail options.

```{r}
ggplot(chi_final) +
  geom_sf(aes(fill = stores_per_10k), color="white", size=0.2) +
  scale_fill_viridis_c(option="magma") +
  theme_minimal()
```

[**Analytic Interpretation:**]{.underline} When adjusted for population, per-capita access remains concentrated in the city’s core and along select North Side corridors, while large portions of the South and Southwest Sides continue to exhibit noticeably lower access. This pattern suggests that both commercial density and residential composition jointly shape neighborhood-level availability of food retailers, amplifying geographic disparities in access.

------------------------------------------------------------------------

To provide a more granular view of where individual stores are located, I built an interactive map that allows users to explore the spatial distribution of every food retailer in the dataset.

```{r}
grocery = st_read(
  "https://data.cityofchicago.org/resource/xqx5-8hwx.geojson?$limit=50000",
  quiet = TRUE
)

grocery_map = grocery %>%
  st_transform(st_crs(chi_final)) %>%
  mutate(
    lon = st_coordinates(geometry)[,1],
    lat = st_coordinates(geometry)[,2]
  )

leaflet(grocery_map) %>%
  addTiles() %>%
  addCircleMarkers(
    lng = ~lon, lat = ~lat,
    radius = 2, stroke = FALSE, fillOpacity = 0.6
  )
```

------------------------------------------------------------------------

K-means clustering is an unsupervised machine learning method that groups observations into distinct clusters based on their similarity. Here, I used it to identify whether Chicago’s community areas naturally sort into meaningful categories based on per-capita retail access and median household income.

```{r}
cluster_data = chi_final %>%
  st_drop_geometry() %>%
  select(community, stores_per_10k, median_income) %>%
  drop_na()

cluster_scaled = cluster_data %>%
  select(stores_per_10k, median_income) %>%
  scale()

set.seed(123)
k3 = kmeans(cluster_scaled, centers = 3, nstart = 25)

cluster_data$cluster = factor(k3$cluster)

chi_final = chi_final %>%
  left_join(cluster_data %>% select(community, cluster), by = "community")

ggplot(chi_final) +
  geom_sf(aes(fill = cluster), color = "white", size = 0.2) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Clusters of Chicago Communities by Retail Access & Income",
    fill = "Cluster"
  ) +
  theme_minimal()

k3$centers
```

[**Analytic Interpretation:**]{.underline} The k-means algorithm groups Chicago’s community areas into three distinct patterns based on standardized retail access and median income. Cluster 1 (green) captures the few neighborhoods with both above-average incomes and substantially above-average retail access. This cluster is primarily concentrated downtown and along the North Side. Cluster 2 (orange) represents communities with moderately above-average incomes and retail access, generally reflecting stable, middle-income areas with established commercial corridors. Cluster 3 (blue) contains neighborhoods with below-average incomes and well-below-average retail access, spanning much of the South, Southwest, and Far Southeast Sides. Together, these clusters illustrate a clear socioeconomic gradient: communities with higher income consistently exhibit stronger per-capita access to food retailers, while lower-income areas experience systematically reduced availability.
